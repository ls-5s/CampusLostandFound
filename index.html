<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <!-- 核心适配：视口设置，禁止缩放，适配移动端 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" /> <!-- 禁止识别手机号 -->
    <title>校园失物招领助手</title>
    <style>
        /* 基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            font-size: 14px;
            /* 移动端基础字号 */
        }

        /* 容器：移动端宽度100%，减少左右间距 */
        .container {
            width: 95%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 5px;
        }

        /* 导航栏：移动端优化 */
        nav {
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-wrap {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            /* 移动端换行 */
            gap: 10px;
            /* 增加间距，防止挤在一起 */
        }

        .logo {
            font-size: 18px;
            /* 移动端缩小logo字号 */
            font-weight: bold;
            color: #2c5282;
        }

        .nav-links {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            /* 链接换行 */
            gap: 8px;
            /* 移动端减少链接间距 */
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            margin-left: 0;
            /* 取消原有margin，用gap控制 */
            font-size: 13px;
            /* 移动端缩小字号 */
            padding: 4px 8px;
            /* 增加点击区域 */
        }

        .nav-links a:hover {
            color: #2c5282;
        }

        /* 按钮适配：增大移动端点击区域 */
        .btn {
            padding: 10px 16px;
            /* 移动端增大内边距 */
            border: none;
            border-radius: 6px;
            /* 增大圆角，更适配移动端 */
            cursor: pointer;
            font-size: 14px;
            min-height: 44px;
            /* 符合移动端最小点击区域规范 */
            min-width: 80px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background-color: #2c5282;
            color: white;
        }

        .btn-primary:hover {
            background-color: #234369;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
            margin-left: 8px;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-danger {
            background-color: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c53030;
        }

        /* 通用模块样式 */
        .section {
            padding: 20px 0;
            /* 移动端减少上下内边距 */
        }

        .title {
            text-align: center;
            margin-bottom: 18px;
            color: #2c5282;
            font-size: 18px;
            /* 移动端标题字号 */
        }

        .card {
            background-color: white;
            border-radius: 10px;
            /* 增大圆角 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 18px;
            /* 移动端调整内边距 */
            margin-bottom: 16px;
            /* 减少间距 */
        }

        /* 表单样式：移动端优化 */
        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            color: #666;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 10px;
            /* 增大内边距，提升输入体验 */
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            min-height: 44px;
            /* 符合移动端输入框规范 */
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2c5282;
            box-shadow: 0 0 0 2px rgba(44, 82, 130, 0.1);
            /* 增加聚焦阴影，更明显 */
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            /* 移动端增大最小高度 */
        }

        /* 登录弹窗：移动端全屏适配 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: flex-start;
            /* 弹窗顶部对齐，避免小屏遮挡 */
            z-index: 999;
            padding: 20px 0;
            overflow-y: auto;
            /* 弹窗内容超出可滚动 */
        }

        .modal-content {
            background-color: white;
            width: 92%;
            /* 移动端更宽 */
            max-width: 400px;
            border-radius: 10px;
            padding: 24px;
            position: relative;
            margin-top: 50px;
            /* 顶部留空 */
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 22px;
            cursor: pointer;
            color: #999;
            width: 44px;
            /* 增大关闭按钮点击区域 */
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #333;
        }

        /* 列表筛选栏：移动端适配 */
        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
            align-items: center;
            padding: 12px;
            /* 增加内边距 */
        }

        .search-input {
            flex: 1;
            min-width: 100%;
            /* 移动端搜索框占满一行 */
            margin-top: 8px;
        }

        /* 列表样式：移动端优化 */
        .item-list {
            display: grid;
            grid-template-columns: 1fr;
            /* 移动端强制单列 */
            gap: 16px;
            margin-top: 16px;
        }

        .item-card {
            padding: 16px;
            border-left: 4px solid #2c5282;
            position: relative;
        }

        .item-tag {
            display: inline-block;
            padding: 4px 10px;
            font-size: 12px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .tag-lost {
            background-color: #fee;
            color: #e53e3e;
        }

        .tag-found {
            background-color: #efe;
            color: #38a169;
        }

        .item-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .item-info {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
            line-height: 1.5;
        }

        .item-desc {
            font-size: 13px;
            color: #666;
            margin: 8px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }

        .item-actions {
            margin-top: 12px;
            display: flex;
            gap: 10px;
        }

        /* 详情弹窗：移动端适配 */
        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: flex-start;
            z-index: 999;
            padding: 20px 0;
            overflow-y: auto;
        }

        .detail-content {
            background-color: white;
            width: 92%;
            max-width: 500px;
            border-radius: 10px;
            padding: 24px;
            position: relative;
            margin-top: 50px;
        }

        /* 页脚：移动端优化 */
        footer {
            background-color: #2c5282;
            color: white;
            text-align: center;
            padding: 16px 0;
            margin-top: 20px;
            font-size: 13px;
        }

        /* 媒体查询：针对小屏手机（<375px） */
        @media (max-width: 375px) {
            .nav-wrap {
                flex-direction: column;
                /* 小屏导航栏纵向排列 */
                align-items: flex-start;
            }

            .nav-links {
                width: 100%;
                justify-content: space-between;
            }

            .btn {
                min-width: 70px;
                padding: 8px 12px;
                font-size: 13px;
            }

            .title {
                font-size: 16px;
            }

            .card {
                padding: 14px;
            }
        }

        /* 媒体查询：平板（>768px）恢复部分样式 */
        @media (min-width: 768px) {
            .item-list {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                /* 平板恢复多列 */
            }

            .search-input {
                min-width: 200px;
                /* 平板搜索框不占满 */
                margin-top: 0;
            }

            .nav-wrap {
                flex-wrap: nowrap;
                /* 平板导航不换行 */
            }
        }
    </style>
</head>

<body>
    <!-- 导航栏 -->
    <nav>
        <div class="container nav-wrap">
            <div class="logo">校园失物招领</div>
            <div class="nav-links">
                <a href="#home">首页</a>
                <a href="#lost">发布失物</a>
                <a href="#found">发布招领</a>
                <a href="#list">物品列表</a>
                <button class="btn btn-primary" onclick="openModal()">登录</button>
            </div>
        </div>
    </nav>

    <!-- 登录弹窗 -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2 class="title">用户登录</h2>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label for="username">用户名/学号</label>
                    <input type="text" id="username" required />
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" required />
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%">
                    登录
                </button>
            </form>
        </div>
    </div>

    <!-- 详情弹窗 -->
    <div class="detail-modal" id="detailModal">
        <div class="detail-content">
            <span class="close-btn" onclick="closeDetailModal()">&times;</span>
            <h2 class="title" id="detailTitle"></h2>
            <div id="detailContent" style="margin-top: 20px"></div>
        </div>
    </div>

    <!-- 首页 -->
    <section id="home" class="section">
        <div class="container">
            <h2 class="title">校园失物招领助手</h2>
            <div class="card">
                <p>
                    欢迎使用校园失物招领平台，在这里你可以发布失物信息、查找招领信息，让遗失的物品早日回家。
                </p>
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap">
                    <a href="#lost"><button class="btn btn-primary">发布失物</button></a>
                    <a href="#found"><button class="btn btn-primary">
                            发布招领
                        </button></a>
                </div>
            </div>
        </div>
    </section>

    <!-- 发布失物 -->
    <section id="lost" class="section">
        <div class="container">
            <h2 class="title">发布失物信息</h2>
            <div class="card">
                <form onsubmit="publishLost(event)">
                    <div class="form-group">
                        <label for="lostName">物品名称</label>
                        <input type="text" id="lostName" placeholder="例如：校园卡、钱包、手机等" required />
                    </div>
                    <div class="form-group">
                        <label for="lostType">物品类型</label>
                        <select id="lostType" required>
                            <option value="">请选择物品类型</option>
                            <option value="校园卡">校园卡</option>
                            <option value="电子产品">电子产品</option>
                            <option value="钱包/证件">钱包/证件</option>
                            <option value="学习用品">学习用品</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lostTime">丢失时间</label>
                        <input type="date" id="lostTime" required />
                    </div>
                    <div class="form-group">
                        <label for="lostLocation">丢失地点</label>
                        <input type="text" id="lostLocation" placeholder="例如：图书馆三楼、篮球场等" required />
                    </div>
                    <div class="form-group">
                        <label for="lostDesc">物品描述</label>
                        <textarea id="lostDesc" placeholder="请描述物品特征、外观等信息"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="lostContact">联系方式</label>
                        <input type="text" id="lostContact" placeholder="电话/微信/QQ等" required />
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%">发布失物信息</button>
                </form>
            </div>
        </div>
    </section>

    <!-- 发布招领 -->
    <section id="found" class="section">
        <div class="container">
            <h2 class="title">发布招领信息</h2>
            <div class="card">
                <form onsubmit="publishFound(event)">
                    <div class="form-group">
                        <label for="foundName">物品名称</label>
                        <input type="text" id="foundName" placeholder="例如：校园卡、钱包、手机等" required />
                    </div>
                    <div class="form-group">
                        <label for="foundType">物品类型</label>
                        <select id="foundType" required>
                            <option value="">请选择物品类型</option>
                            <option value="校园卡">校园卡</option>
                            <option value="电子产品">电子产品</option>
                            <option value="钱包/证件">钱包/证件</option>
                            <option value="学习用品">学习用品</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="foundTime">捡到时间</label>
                        <input type="date" id="foundTime" required />
                    </div>
                    <div class="form-group">
                        <label for="foundLocation">捡到地点</label>
                        <input type="text" id="foundLocation" placeholder="例如：图书馆三楼、篮球场等" required />
                    </div>
                    <div class="form-group">
                        <label for="foundDesc">物品描述</label>
                        <textarea id="foundDesc" placeholder="请描述物品特征、外观等信息"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="foundContact">联系方式</label>
                        <input type="text" id="foundContact" placeholder="电话/微信/QQ等" required />
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%">发布招领信息</button>
                </form>
            </div>
        </div>
    </section>

    <!-- 物品列表 -->
    <section id="list" class="section">
        <div class="container">
            <h2 class="title">失物招领列表</h2>

            <!-- 筛选和搜索栏 -->
            <div class="filter-bar card">
                <button class="btn btn-primary" onclick="filterItems('all')">
                    全部
                </button>
                <button class="btn btn-secondary" onclick="filterItems('lost')">
                    失物
                </button>
                <button class="btn btn-secondary" onclick="filterItems('found')">
                    招领
                </button>
                <input type="text" id="searchInput" class="search-input" placeholder="搜索物品名称/地点..."
                    oninput="searchItems()" />
            </div>

            <!-- 物品列表容器 -->
            <div class="item-list" id="itemListContainer">
                <!-- 动态渲染内容 -->
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer>
        <div class="container">校园失物招领助手 © 2025 版权所有</div>
    </footer>

    <script>
        // 全局变量
        let itemList = [];
        let currentFilter = "all"; // 当前筛选类型：all/lost/found
        let currentUser = null;

        // ========== 登录相关 ==========
        function openModal() {
            document.getElementById("loginModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("loginModal").style.display = "none";
        }

        // 点击弹窗外部关闭
        window.onclick = function (event) {
            const modal = document.getElementById("loginModal");
            const detailModal = document.getElementById("detailModal");
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === detailModal) {
                closeDetailModal();
            }
        };

        // 模拟用户数据
        const mockUsers = [
            {
                username: "123456",
                password: "123456",
                name: "蓝鹏",
                role: "学生",
            },
            {
                username: "admin",
                password: "admin123",
                name: "管理员",
                role: "管理员",
            },
        ];

        // 登录验证
        function login(e) {
            e.preventDefault();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();

            if (!username || !password) {
                alert("请输入账号和密码！");
                return;
            }

            const user = mockUsers.find(
                (u) => u.username === username && u.password === password
            );
            if (user) {
                sessionStorage.setItem("loginUser", JSON.stringify(user));
                currentUser = user;
                updateUserUI(user);
                closeModal();
                alert(`欢迎你，${user.name}！`);
                // 重新渲染列表（显示删除按钮）
                renderItemList();
            } else {
                alert("账号或密码错误！");
                document.getElementById("password").value = "";
            }
        }

        // 更新用户UI
        function updateUserUI(user) {
            const navLinks = document.querySelector(".nav-links");
            const loginBtn = navLinks.querySelector(".btn-primary");
            if (loginBtn) {
                loginBtn.outerHTML = `
                    <span style="margin-left:8px; font-size:13px;">欢迎：${user.name}</span>
                    <button class="btn btn-primary" style="margin-left:8px;" onclick="logout()">退出</button>
                `;
            }
        }

        // 退出登录
        function logout() {
            sessionStorage.removeItem("loginUser");
            currentUser = null;
            const navLinks = document.querySelector(".nav-links");
            const userInfo = navLinks.querySelector("span");
            if (userInfo) {
                userInfo.nextElementSibling.remove();
                userInfo.outerHTML = `<button class="btn btn-primary" onclick="openModal()">登录</button>`;
            }
            // 重新渲染列表（隐藏删除按钮）
            renderItemList();
            alert("已退出登录！");
        }

        // ========== 失物/招领信息核心逻辑 ==========
        // 初始化：从sessionStorage读取数据
        function initItemList() {
            const storedItems = sessionStorage.getItem("lostFoundItems");
            itemList = storedItems
                ? JSON.parse(storedItems)
                : [
                    // 默认示例数据（添加发布者字段）
                    {
                        id: 1,
                        type: "lost",
                        name: "校园卡",
                        itemType: "校园卡",
                        time: "2025-01-15",
                        location: "图书馆三楼自习区",
                        contact: "12345678910",
                        desc: "蓝色卡套，学号：2023001001",
                        publisher: "student1",
                    },
                    {
                        id: 2,
                        type: "found",
                        name: "黑色钱包",
                        itemType: "钱包/证件",
                        time: "2025-01-14",
                        location: "食堂一楼",
                        contact: "12345678910",
                        desc: "内含身份证、银行卡若干，现金少量",
                        publisher: "admin",
                    },
                    {
                        id: 3,
                        type: "lost",
                        name: "AirPods Pro",
                        itemType: "电子产品",
                        time: "2025-01-13",
                        location: "教学楼A栋302教室",
                        contact: "12345678910",
                        desc: "白色耳机盒，黑色保护套",
                        publisher: "student1",
                    },
                ];
            renderItemList(); // 渲染列表
        }

        // 渲染物品列表（支持筛选和权限控制）
        function renderItemList(filteredItems = null) {
            const listContainer = document.getElementById("itemListContainer");
            listContainer.innerHTML = "";

            // 确定要渲染的列表（筛选后/全部）
            const itemsToRender =
                filteredItems ||
                (currentFilter === "all"
                    ? itemList
                    : itemList.filter((item) => item.type === currentFilter));

            if (itemsToRender.length === 0) {
                listContainer.innerHTML = `<div class="card" style="text-align:center; padding:30px;">暂无相关物品信息</div>`;
                return;
            }

            // 遍历生成列表项
            itemsToRender.forEach((item) => {
                const itemCard = document.createElement("div");
                itemCard.className = "card item-card";

                // 判断当前登录用户是否有权限删除
                const canDelete =
                    currentUser &&
                    (currentUser.username === item.publisher || // 发布者本人
                        currentUser.role === "管理员"); // 管理员权限

                itemCard.innerHTML = `
                    <span class="item-tag ${item.type === "lost" ? "tag-lost" : "tag-found"
                    }">
                        ${item.type === "lost" ? "失物" : "招领"}
                    </span>
                    <div class="item-title">${item.name}</div>
                    <div class="item-info">物品类型：${item.itemType}</div>
                    <div class="item-info">${item.type === "lost" ? "丢失" : "捡到"
                    }地点：${item.location}</div>
                    <div class="item-info">${item.type === "lost" ? "丢失" : "捡到"
                    }时间：${item.time}</div>
                    ${item.desc
                        ? `<div class="item-desc">描述：${item.desc}</div>`
                        : ""
                    }
                    <div class="item-actions">
                        <button class="btn btn-primary" onclick="viewItemDetail(${item.id
                    })" style="flex:1">查看详情</button>
                        ${canDelete
                        ? `<button class="btn btn-danger" onclick="deleteItem(${item.id})" style="flex:1">删除</button>`
                        : ""
                    }
                    </div>
                `;
                listContainer.appendChild(itemCard);
            });
        }

        // 保存数据到sessionStorage
        function saveItemList() {
            sessionStorage.setItem("lostFoundItems", JSON.stringify(itemList));
        }

        // 筛选物品
        function filterItems(type) {
            currentFilter = type;
            // 更新筛选按钮样式
            const filterBtns = document.querySelectorAll(".filter-bar .btn");
            filterBtns.forEach((btn) => {
                btn.classList.remove("btn-primary");
                btn.classList.add("btn-secondary");
            });
            event.target.classList.remove("btn-secondary");
            event.target.classList.add("btn-primary");
            // 重新渲染
            renderItemList();
        }

        // 搜索物品
        function searchItems() {
            const searchText = document
                .getElementById("searchInput")
                .value.trim()
                .toLowerCase();
            if (!searchText) {
                renderItemList(); // 清空搜索，恢复筛选结果
                return;
            }
            // 模糊搜索：名称/地点/类型
            const filtered = itemList.filter(
                (item) =>
                    item.name.toLowerCase().includes(searchText) ||
                    item.location.toLowerCase().includes(searchText) ||
                    item.itemType.toLowerCase().includes(searchText)
            );
            renderItemList(filtered);
        }

        // 查看物品详情
        function viewItemDetail(itemId) {
            const item = itemList.find((i) => i.id === itemId);
            if (!item) return;

            // 填充详情内容
            document.getElementById("detailTitle").textContent = `${item.type === "lost" ? "失物详情" : "招领详情"
                }`;
            document.getElementById("detailContent").innerHTML = `
                <div class="item-info"><strong>物品名称：</strong>${item.name
                }</div>
                <div class="item-info"><strong>物品类型：</strong>${item.itemType
                }</div>
                <div class="item-info"><strong>${item.type === "lost" ? "丢失" : "捡到"
                }时间：</strong>${item.time}</div>
                <div class="item-info"><strong>${item.type === "lost" ? "丢失" : "捡到"
                }地点：</strong>${item.location}</div>
                <div class="item-info"><strong>联系方式：</strong>${item.contact
                }</div>
                ${item.desc
                    ? `<div class="item-info"><strong>物品描述：</strong>${item.desc}</div>`
                    : ""
                }
            `;

            // 显示详情弹窗
            document.getElementById("detailModal").style.display = "flex";
        }

        // 关闭详情弹窗
        function closeDetailModal() {
            document.getElementById("detailModal").style.display = "none";
        }

        // 删除物品信息（权限验证）
        function deleteItem(itemId) {
            if (!currentUser) {
                alert("请先登录！");
                openModal();
                return;
            }

            const item = itemList.find((i) => i.id === itemId);
            if (!item) {
                alert("该信息不存在！");
                return;
            }

            // 权限验证：仅发布者/管理员可删除
            const hasPermission =
                currentUser.username === item.publisher ||
                currentUser.role === "管理员";
            if (!hasPermission) {
                alert("你没有权限删除这条信息！");
                return;
            }

            if (confirm("确定要删除这条信息吗？")) {
                itemList = itemList.filter((item) => item.id !== itemId);
                saveItemList();
                renderItemList();
                alert("信息已删除！");
            }
        }

        // 发布失物信息（记录发布者）
        function publishLost(e) {
            e.preventDefault();
            // 验证登录
            if (!currentUser) {
                alert("请先登录！");
                openModal();
                return;
            }

            // 获取表单数据
            const name = document.getElementById("lostName").value.trim();
            const itemType = document.getElementById("lostType").value;
            const time = document.getElementById("lostTime").value;
            const location = document.getElementById("lostLocation").value.trim();
            const desc = document.getElementById("lostDesc").value.trim();
            const contact = document.getElementById("lostContact").value.trim();

            // 验证必填项
            if (!name || !itemType || !time || !location || !contact) {
                alert("请填写所有必填项！");
                return;
            }

            // 生成唯一ID
            const newId =
                itemList.length > 0 ? Math.max(...itemList.map((i) => i.id)) + 1 : 1;

            // 添加新数据（包含发布者信息）
            itemList.unshift({
                id: newId,
                type: "lost",
                name,
                itemType,
                time,
                location,
                desc,
                contact,
                publisher: currentUser.username,
            });

            // 保存并重新渲染
            saveItemList();
            renderItemList();

            // 清空表单
            document.querySelector("#lost form").reset();
            alert("失物信息发布成功！");
        }

        // 发布招领信息（记录发布者）
        function publishFound(e) {
            e.preventDefault();
            // 验证登录
            if (!currentUser) {
                alert("请先登录！");
                openModal();
                return;
            }

            // 获取表单数据
            const name = document.getElementById("foundName").value.trim();
            const itemType = document.getElementById("foundType").value;
            const time = document.getElementById("foundTime").value;
            const location = document.getElementById("foundLocation").value.trim();
            const desc = document.getElementById("foundDesc").value.trim();
            const contact = document.getElementById("foundContact").value.trim();

            // 验证必填项
            if (!name || !itemType || !time || !location || !contact) {
                alert("请填写所有必填项！");
                return;
            }

            // 生成唯一ID
            const newId =
                itemList.length > 0 ? Math.max(...itemList.map((i) => i.id)) + 1 : 1;

            // 添加新数据（包含发布者信息）
            itemList.unshift({
                id: newId,
                type: "found",
                name,
                itemType,
                time,
                location,
                desc,
                contact,
                publisher: currentUser.username,
            });

            // 保存并重新渲染
            saveItemList();
            renderItemList();

            // 清空表单
            document.querySelector("#found form").reset();
            alert("招领信息发布成功！");
        }

        // ========== 页面初始化 ==========
        window.onload = function () {
            // 初始化用户状态
            const storedUser = sessionStorage.getItem("loginUser");
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                updateUserUI(currentUser);
            }

            // 初始化物品列表
            initItemList();

            // 平滑滚动
            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
                anchor.addEventListener("click", function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute("href"));
                    if (target) {
                        window.scrollTo({
                            top: target.offsetTop - 80,
                            behavior: "smooth",
                        });
                    }
                });
            });
        };
    </script>
</body>

</html>