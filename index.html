<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3D å¯ä¸Šä¼ ç›¸å†Œ</title>
    <style>
        /* ==================== 
           CSS å˜é‡é…ç½® (ä¸»é¢˜å®šåˆ¶)
           ==================== */
        :root {
            --card-width: 200px;
            --card-height: 300px;
            --card-width-mobile: 140px;
            --card-height-mobile: 210px;

            /* æ¸…æ–°è‡ªç„¶ä¸»é¢˜ */
            --bg-gradient-start: #e0f7fa;
            --bg-gradient-end: #e8f5e9;
            --text-color: #ffffff;
            --shadow-color: rgba(0, 50, 30, 0.15);
        }

        /* ==================== 
           åŸºç¡€é‡ç½®
           ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            cursor: grab;
            user-select: none;
        }

        body:active {
            cursor: grabbing;
        }

        /* ==================== 
           èƒŒæ™¯è£…é¥°
           ==================== */
        .decor-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.6;
            animation: float 10s infinite ease-in-out;
        }

        .blob:nth-child(1) {
            width: 300px;
            height: 300px;
            background: #b2dfdb;
            top: -50px;
            left: -50px;
        }

        .blob:nth-child(2) {
            width: 200px;
            height: 200px;
            background: #c8e6c9;
            bottom: 10%;
            right: 10%;
            animation-delay: -3s;
        }

        .blob:nth-child(3) {
            width: 150px;
            height: 150px;
            background: #b3e5fc;
            top: 40%;
            left: 60%;
            animation-delay: -5s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-20px) scale(1.05);
            }
        }

        /* ==================== 
           3D èˆå°
           ==================== */
        #stage {
            perspective: 1000px;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #spin-container {
            position: relative;
            width: var(--card-width);
            height: var(--card-height);
            transform-style: preserve-3d;
            transition: transform 0.1s;
            /* ç¨å¾®å¢åŠ å“åº”é€Ÿåº¦ */
        }

        /* ==================== 
           å¡ç‰‡æ ·å¼
           ==================== */
        .card {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 30px var(--shadow-color);
            overflow: hidden;
            -webkit-box-reflect: below 10px linear-gradient(transparent, transparent, rgba(0, 0, 0, 0.2));
            /* å…³é”®ï¼šå¢åŠ å˜æ¢è¿‡æ¸¡ï¼Œè®©é‡æ–°æ’åˆ—æ—¶æœ‰åŠ¨ç”» */
            transition: transform 1s ease-out;
            border: 4px solid #fff;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .caption {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px 10px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent);
            color: var(--text-color);
            text-align: center;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            transform: translateY(100%);
            transition: transform 0.3s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card:hover .caption {
            transform: translateY(0);
        }

        /* ==================== 
           UI æ§åˆ¶å±‚
           ==================== */
        #controls {
            position: absolute;
            bottom: 30px;
            z-index: 10;
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px 25px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn {
            border: none;
            background: transparent;
            font-size: 22px;
            cursor: pointer;
            color: #455a64;
            transition: transform 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            transform: scale(1.2);
            color: #00897b;
        }

        /* éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† */
        #upload-input {
            display: none;
        }

        .tips {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: #546e7a;
            font-size: 14px;
            pointer-events: none;
            opacity: 0.7;
        }

        @media (max-width: 600px) {
            #spin-container {
                width: var(--card-width-mobile);
                height: var(--card-height-mobile);
            }
        }
    </style>
</head>

<body>

    <div class="decor-bg">
        <div class="blob"></div>
        <div class="blob"></div>
        <div class="blob"></div>
    </div>

    <div class="tips">æ‹–æ‹½æ—‹è½¬ Â· æ»šè½®ç¼©æ”¾ Â· åº•éƒ¨æŒ‰é’®æ·»åŠ å›¾ç‰‡</div>

    <div id="stage">
        <div id="spin-container">
            <div class="card" data-title="é»˜è®¤å›¾ç‰‡1">
                <img src="https://picsum.photos/400/600?random=10" alt="1">
                <div class="caption">æ˜¥æ—¥åºæ›²</div>
            </div>
            <div class="card" data-title="é»˜è®¤å›¾ç‰‡2">
                <img src="https://picsum.photos/400/600?random=11" alt="2">
                <div class="caption">å¤æ—¥æµ·å²¸</div>
            </div>
            <div class="card" data-title="é»˜è®¤å›¾ç‰‡3">
                <img src="https://picsum.photos/400/600?random=12" alt="3">
                <div class="caption">ç§‹æ—¥ç§è¯­</div>
            </div>
            <div class="card" data-title="é»˜è®¤å›¾ç‰‡4">
                <img src="https://picsum.photos/400/600?random=13" alt="4">
                <div class="caption">å†¬æ—¥æš–é˜³</div>
            </div>
            <div class="card" data-title="é»˜è®¤å›¾ç‰‡5">
                <img src="https://picsum.photos/400/600?random=14" alt="5">
                <div class="caption">äº‘ç«¯æ¼«æ­¥</div>
            </div>
        </div>
    </div>

    <div id="controls">
        <button class="btn" id="btn-upload" title="ä¸Šä¼ å›¾ç‰‡">ğŸ“¤</button>
        <button class="btn" id="toggle-spin" title="æ’­æ”¾/æš‚åœ">â¯</button>
        <button class="btn" id="reset-view" title="é‡ç½®è§†è§’">â†º</button>
        <input type="file" id="upload-input" multiple accept="image/*">
    </div>

    <script>
        const stage = document.getElementById('stage');
        const container = document.getElementById('spin-container');
        // getElementsByClassName æ˜¯åŠ¨æ€é›†åˆï¼Œæ·»åŠ å…ƒç´ åä¼šè‡ªåŠ¨æ›´æ–°
        const cards = document.getElementsByClassName('card');

        // æŒ‰é’®å…ƒç´ 
        const btnUpload = document.getElementById('btn-upload');
        const uploadInput = document.getElementById('upload-input');
        const btnToggle = document.getElementById('toggle-spin');
        const btnReset = document.getElementById('reset-view');

        // === çŠ¶æ€ç®¡ç† ===
        let state = {
            autoRotate: true,
            rotateSpeed: -0.2,
            dragSpeed: 0.25,
            radius: 0,
            rotateY: 0,
            rotateX: -10,
            targetRotateY: 0,
            targetRotateX: -10,
            scale: 1
        };

        // å†…éƒ¨å˜é‡
        let isDragging = false;
        let startX, startY, lastX, lastY;

        // === 1. å¸ƒå±€æ ¸å¿ƒç®—æ³• (å«åŠ¨æ€æ›´æ–°) ===
        function initLayout() {
            const cardCount = cards.length;
            if (cardCount === 0) return;

            const cardWidth = container.offsetWidth;

            // åŠ¨æ€è®¡ç®—åŠå¾„ï¼šç¡®ä¿å¡ç‰‡ä¸é‡å ä¸”æœ‰é—´éš™
            // åŸºç¡€å…¬å¼ï¼šr = (w / 2) / tan(PI / n)
            // å½“å¡ç‰‡å¾ˆå°‘æ—¶(æ¯”å¦‚1-2å¼ )ï¼Œç»™ä¸€ä¸ªæœ€å°åŠå¾„ï¼Œé˜²æ­¢æŒ¤åœ¨ä¸€èµ·
            const minRadius = cardCount < 3 ? 150 : 0;
            state.radius = Math.max(minRadius, Math.round((cardWidth / 2) / Math.tan(Math.PI / cardCount))) + 30;

            for (let i = 0; i < cardCount; i++) {
                const angle = i * (360 / cardCount);
                // åº”ç”¨å˜æ¢
                cards[i].style.transform = `rotateY(${angle}deg) translateZ(${state.radius}px)`;
                // é‡æ–°è®¡ç®—å»¶è¿Ÿï¼Œä¿è¯åŠ¨ç”»æµç•…
                cards[i].style.transitionDelay = (i * 0.05) + 's';
            }
        }

        // === 2. ä¸Šä¼ åŠŸèƒ½å®ç° ===
        btnUpload.onclick = (e) => {
            e.stopPropagation(); // é˜²æ­¢è§¦å‘èˆå°ç‚¹å‡»
            uploadInput.click(); // è§¦å‘æ–‡ä»¶é€‰æ‹©
        };

        uploadInput.onchange = (e) => {
            const files = e.target.files;
            if (!files.length) return;

            // éå†é€‰æ‹©çš„æ–‡ä»¶
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    // åˆ›å»ºæ–°å¡ç‰‡ DOM
                    const newCard = document.createElement('div');
                    newCard.className = 'card';
                    // ä½¿ç”¨æ–‡ä»¶åä½œä¸ºæ ‡é¢˜ (å»é™¤åç¼€)
                    const title = file.name.replace(/\.[^/.]+$/, "");

                    newCard.innerHTML = `
                        <img src="${event.target.result}" alt="Uploaded">
                        <div class="caption">${title}</div>
                    `;

                    // æ·»åŠ åˆ°å®¹å™¨
                    container.appendChild(newCard);

                    // â˜… å…³é”®ï¼šæ¯æ¬¡æ·»åŠ åé‡æ–°è®¡ç®—å¸ƒå±€
                    // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿ DOM æ›´æ–°åå†è®¡ç®—
                    requestAnimationFrame(() => {
                        initLayout();
                    });
                };
                reader.readAsDataURL(file);
            });

            // é‡ç½® input ä»¥ä¾¿å…è®¸é‡å¤ä¸Šä¼ åŒä¸€æ–‡ä»¶
            uploadInput.value = '';
        };

        // === 3. äº¤äº’é€»è¾‘ (æ‹–æ‹½) ===
        function handleStart(x, y) {
            isDragging = true;
            state.autoRotate = false;
            startX = lastX = x;
            startY = lastY = y;
        }

        function handleMove(x, y) {
            if (!isDragging) return;
            const deltaX = x - lastX;
            const deltaY = y - lastY;

            state.targetRotateY += deltaX * state.dragSpeed;
            state.targetRotateX -= deltaY * state.dragSpeed;
            state.targetRotateX = Math.max(-30, Math.min(30, state.targetRotateX));

            lastX = x;
            lastY = y;
        }

        function handleEnd() { isDragging = false; }

        document.onpointerdown = (e) => handleStart(e.clientX, e.clientY);
        document.onpointermove = (e) => handleMove(e.clientX, e.clientY);
        document.onpointerup = handleEnd;

        // æ»šè½®ç¼©æ”¾
        document.onwheel = (e) => {
            e.preventDefault();
            state.scale += e.deltaY * -0.001;
            state.scale = Math.max(0.2, Math.min(2.5, state.scale));
        };

        // === 4. åŠ¨ç”»ä¸UI ===
        function animate() {
            if (state.autoRotate && !isDragging) {
                state.targetRotateY += state.rotateSpeed;
            }

            // æƒ¯æ€§æ’å€¼
            state.rotateY += (state.targetRotateY - state.rotateY) * 0.1;
            state.rotateX += (state.targetRotateX - state.rotateX) * 0.1;

            container.style.transform = `translateZ(${-state.radius}px) rotateX(${state.rotateX}deg) rotateY(${state.rotateY}deg) scale(${state.scale})`;
            requestAnimationFrame(animate);
        }

        btnToggle.onclick = (e) => {
            e.stopPropagation();
            state.autoRotate = !state.autoRotate;
            if (state.autoRotate) state.targetRotateY = state.rotateY;
        };

        btnReset.onclick = (e) => {
            e.stopPropagation();
            state.targetRotateX = -10;
            state.scale = 1;
            state.autoRotate = true;
        };

        stage.onclick = () => {
            state.autoRotate = !state.autoRotate;
            if (state.autoRotate) state.targetRotateY = state.rotateY;
        }

        window.onresize = initLayout;

        // å¯åŠ¨
        initLayout();
        animate();

    </script>
</body>

</html>